<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Add Plan/Songs</title>
  </head>
  <body>
    <div class="main-container">
      <div class="desktop-left-side">
        <div class="branding-title">
          <h1 class="title-branding">Immanuel Prarthana Bhawan</h1>
          <h1 class="slogon-branding">worship planning</h1>
        </div>
        <div class="navigation-container">
          <a
            href="index.html"
            class="single-nav"
            style="background-color: rgb(145, 145, 145)"
          >
            <p class="single-nav-text">Worship Planning</p>
            <img
              src="./assects/arrow-icon.png"
              class="nav-arrow-image"
              alt="custom"
            />
          </a>
          <a
            href="./worshipdays.html"
            class="single-nav"
            style="background-color: rgb(145, 145, 145)"
          >
            <p class="single-nav-text">all worship days</p>
            <img
              src="./assects/arrow-icon.png"
              class="nav-arrow-image"
              alt="custom"
            />
          </a>
          <a
            href="./pdfiles.html"
            class="single-nav"
            style="background-color: rgb(145, 145, 145)"
          >
            <p class="single-nav-text">pdf files</p>
            <img
              src="./assects/arrow-icon.png"
              class="nav-arrow-image"
              alt="custom"
            />
          </a>
          <a
            href="./allsongs.html"
            class="single-nav"
            style="background-color: rgb(145, 145, 145)"
          >
            <p class="single-nav-text">all songs</p>
            <img
              src="./assects/arrow-icon.png"
              class="nav-arrow-image"
              alt="custom"
            />
          </a>
          <a
            href="./addsong.html"
            class="single-nav"
            style="background-color: rgb(50, 90, 128)"
          >
            <p class="single-nav-text">add plan/song</p>
            <img
              src="./assects/arrow-icon.png"
              class="nav-arrow-image"
              alt="custom"
            />
          </a>
        </div>
      </div>
      <div class="division81391">
        <!-- this is login page -->
        <div class="login-form">
          <div class="main">
            <input type="checkbox" id="chk" aria-hidden="true" />

            <div class="login">
              <form class="lo-form">
                <label for="chk" aria-hidden="true">Log in</label>
                <input
                  oninput="textOnchange(event,'phone')"
                  class="input"
                  type="phone"
                  maxlength="10"
                  name="phone"
                  placeholder="Phone"
                  required=""
                />
                <input
                  class="input"
                  type="password"
                  oninput="textOnchange(event,'pass')"
                  name="pswd"
                  placeholder="Password"
                  required=""
                />
                <button type="button" onclick="LoginHandler()">Log in</button>
              </form>
            </div>

            <div class="register">
              <form class="lo-form">
                <label for="chk" aria-hidden="true">Register</label>
                <input
                  class="input"
                  type="text"
                  name="txt"
                  oninput="textOnchange(event,'name')"
                  placeholder="Name"
                  required=""
                />
                <input
                  class="input"
                  type="phone"
                  maxlength="10"
                  oninput="textOnchange(event,'phone')"
                  name="phone"
                  placeholder="Phone"
                  required=""
                />
                <input
                  class="input"
                  type="password"
                  oninput="textOnchange(event,'pass')"
                  name="pswd"
                  placeholder="Password"
                  required=""
                />
                <button type = 'button' onclick = "RegisterHandler()">Register</button>
              </form>
            </div>
          </div>
        </div>
        <!-- form starts from here -->
        <form class="container-form"> </form>
      </div>
    </div>
    <script src ="./loginhandle.js"></script>
    <script>


// from her i'll open storing data of the user details


// until i'm going to use code for store user details

        let songform = document.querySelector('.container-form')
        let loginform = document.querySelector('.login-form')
      const replaceform =`  
          <label for="preparation">It is for Plan Prepare:</label>

          <label class="container">
            <input
              onchange="toggleVisibility()"
              id="preparation"
              name="preparation"
              type="checkbox"
            />
            <svg viewBox="0 0 64 64" height="2em" width="2em">
              <path
                d="M 0 16 V 56 A 8 8 90 0 0 8 64 H 56 A 8 8 90 0 0 64 56 V 8 A 8 8 90 0 0 56 0 H 8 A 8 8 90 0 0 0 8 V 16 L 32 48 L 64 16 V 8 A 8 8 90 0 0 56 0 H 8 A 8 8 90 0 0 0 8 V 56 A 8 8 90 0 0 8 64 H 56 A 8 8 90 0 0 64 56 V 16"
                pathLength="575.0541381835938"
                class="path"
              ></path>
            </svg>
          </label>

          <br />

          <div class="preparation-fields hidden">
            <label for="preparation-date">Preparation for:</label>
            <input
              type="date"
              id="preparation-date"
              name="preparation-date"
            /><br />
          </div>

          <div class = "plan-songs-list"></div>
          <hr />



          <!-- Divider -->

          <h2>Add Songs</h2>
          <div id="song-container">
           
            <div class="song">
            <label for="song-name-hindi-english"
              >Song Name in Hindi English:</label
            >
            <input
              type="text"
              oninput = "typeinputChanged(this)"
              id="song-name-hindi-english"
              name="song-name-hindi-english"
            /><br />
            <div class = 'recomendation-box'>
              <strong>Already Existing Songs <span>(click to add on plan list)</span></strong>
              <div class = 'single-songs-container'></div>
             
              </div>
            <label for="song-name-hindi-english"
              >Youtube video link:</label
            >
            <input
              type="text"
              oninput = "typeinputChanged(this)"
              id="song-name-hindi-english"
              name="youtube-video-url"
            /><br />

         

            <label for="song-type">Song Type:</label>
            <select id="song-type" name="song-type">
              <option value="stuti">Stuti</option>
              <option value="aaradhan">Aaradhan</option>
              <option value="inspirational">Inspirational</option>
              <option value="thanks-giving">Thanks Giving</option>
              <option value="priding">Priding</option></select
            ><br />

            <label for="song-lyrics">Song Lyrics or Chords:</label>
            <textarea oninput = "LyricsTextarea(this)" id="song-lyrics" name="song-lyrics"></textarea><br />
            <hr/>
            </div>
          </div>
          <div class="add-button">
            <input
              type="button"
              value="Add"
              onclick="addSong()"
              id="add-song"
            /><br />
          </div>
          <input type="button" onclick = "submitDataForm()" value="Submit" />
       `


      function toggleVisibility() {
       

        var checkBox = document.getElementById("preparation");
        var fields = document.getElementsByClassName("preparation-fields");
        for (var i = 0; i < fields.length; i++) {
          if (checkBox.checked == true) {
            fields[i].style.display = "block";
          } else {
            fields[i].style.display = "none";
          }
        }
      }

      function addSong() {
        var container = document.getElementById("song-container");

        var songHTML = `
                <div class="song">
                 
                    <label for="song-name-hindi-english">Song Name in Hindi English:</label>
                    <input type="text" id="song-name-hindi-english" name="song-name-hindi-english"><br>
                    <label for="song-name-hindi-english"
              >Youtube video link:</label
            >
            <input
              type="text"
              oninput = "typeinputChanged(this)"
              id="song-name-hindi-english"
              name="youtube-video-url"
            /><br />
                    <label for="song-type">Song Type:</label>
                    <select id="song-type" name="song-type">
                        <option value="stuti">Stuti</option>
                        <option value="aaradhan">Aaradhan</option>
                        <option value="inspirational">Inspirational</option>
                        <option value="thanks-giving">Thanks Giving</option>
                        <option value="priding">Priding</option>
                    </select><br>
                    <label for="song-lyrics">Song Lyrics or Chords:</label>
                    <textarea oninput = "LyricsTextarea(this)" id="song-lyrics" name="song-lyrics"></textarea><br>
                </div>
                <hr/>
            `;

        container.innerHTML += songHTML;
      }
    </script>
    <script src="./script.js"></script>

    <script>
      let phone;
      let pass;
      let name;
      let planSongs = []
      const textOnchange = (e, variableName) => {
        window[variableName] = e.target.value;
      };

 
// it is specially desigled for add songs





const submitDataForm = () =>{
  const planChecker = document.getElementById('preparation').checked
  const planDate = document.getElementById('preparation-date')
  const planpdf = document.getElementById('prepared-file')



  const allsongs = document.querySelectorAll('.song')
let songs = [];

for (let i = 0; i < allsongs.length; i++) {
    const object = {};
  const song = allsongs[i];
  
  const title = song.querySelector('input[name="song-name-hindi-english"]').value;
  object.title = title;

  const songtype = song.querySelector('select[name="song-type"]').value;
  object.songtype = songtype;

  const videourl = song.querySelector('input[name="youtube-video-url"]').value;
  object.videourl = videourl;
  
      object.songby = userdetails.name;
      const songlyrics = song.querySelector('textarea[name="song-lyrics"]').value;
  object.lyrics = songlyrics;
    if(title.length > 2 && songlyrics.length > 2){
      songs = [...songs,object]

    }else{
      window.alert('song must have title and lyrics')
    }
}


// from here we will work with api
if(planChecker && !songs.length){

     let tempPlanresources = { 
              date: document.getElementById('preparation-date').value,
              plansongs: planSongs,
              planby: userdetails.name
            }
    fetch(serverURL+"addplan", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ plan : tempPlanresources }),
        })
          .then((response) => response.json()).then(plandata => 
         { window.alert('your Plan is added successfully')
          return;}
          )
  }
if(planChecker && songs.length>0){

  
  fetch(serverURL+"addsongs", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ songs : songs }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data)
            fetch(serverURL+"addsongs", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ songs : songs }),
        })
          .then((response) => response.json())
          .then((data) => {
            planSongs = [...planSongs,...data]
            let tempPlanresources = { 
              date: document.getElementById('preparation-date').value,
              plansongs: planSongs,
              planby: userdetails.name
            }
// from here we are going to add for add plansongContainer
fetch(serverURL+"addplan", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ plan : tempPlanresources }),
        })
          .then((response) => response.json()).then(plandata => 
          window.alert('your plan and songs are added successfully')
          )


            window.alert('your song added successfully')
          });
          });
}else{
  if(songs.length>0){
  fetch(serverURL+"addsongs", {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ songs : songs }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data)
            window.alert('your song added successfully')
          });
}
}
}

function  LyricsTextarea(data){

  data.style.height = 'auto';
  data.style.height = data.scrollHeight + 'px';
}


const docInput = document.getElementById('prepared-file');

const UploadChange = (event) =>{
  const file = event.files[0]
  const formData = new FormData();
  formData.append('file', file);
  fetch(serverURL+'upload', {
    method: 'POST',
    body: formData
  })
  .then(res => res.json()) 
  .then(result => {
    // Handle response
  })
}


// below code for add recommended songs on planlist
let recoresults;
const AddplanSong = (song) =>{
  let plansongContainer = document.querySelector('.plan-songs-list')
  plansongContainer.innerHTML = ""
  const selectedsong = recoresults.find(x => x.songid ===song )
  let tempobject = {songid: selectedsong.songid, title: selectedsong.title}

  planSongs = [...planSongs,tempobject]
  console.log(plansongContainer)
  for(let i = 0; i< planSongs.length; i++){
    let tempsong = `<div style = "width: auto;" class='single-recomendation'>
                <p>${planSongs[i].title}</p>
                </div>`
    plansongContainer.innerHTML += tempsong
  }
}

// here it is for recomendation on typing stop




let typingTimer;
const doneTypingInterval = 1000; // Time in milfliseconds (1 second)

function typeinputChanged(event) {
  let reccomendationbox = document.querySelector('.recomendation-box')
  let recosongsbox = document.querySelector('.single-songs-container')
  reccomendationbox.style.display = 'none'
 
  clearTimeout(typingTimer);
  typingTimer = setTimeout(function() {

if(event.value.length>3){
  fetch(serverURL+'songreco', {
    method: 'POST',
    body: JSON.stringify({keyword: event.value}),
    headers: { "Content-Type": "application/json" },
  })
  .then(res => res.json()) 
  .then(result => {
    if(result.length){
      recoresults = result;
      reccomendationbox.style.display = 'block'
      recosongsbox.innerHTML = ''
      for(let i = 0; i < result.length; i++){
      
        let datahtml = `<div onclick ="AddplanSong('${result[i].songid}')" class='single-recomendation'>
                <p>${result[i].title}</p>
                </div>`
                recosongsbox.innerHTML += datahtml
              }


    }


  })
}
    
  }, doneTypingInterval);
}





    </script>
  </body>
</html>
